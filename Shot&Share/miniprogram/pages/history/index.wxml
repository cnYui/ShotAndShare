<!--history.wxml-->
<view class="container">
  <!-- 头部操作栏 -->
  <view class="header-bar">
    <view class="header-title">历史记录</view>
    <view class="header-actions">
      <view class="action-btn" bindtap="filterByStyle">
        <text class="action-icon">🎨</text>
        <text class="action-text">筛选</text>
      </view>
      <view class="action-btn" bindtap="sortRecords">
        <text class="action-icon">📊</text>
        <text class="action-text">排序</text>
      </view>
    </view>
  </view>

  <!-- 统计信息 -->
  <view class="stats-bar" wx:if="{{records.length > 0}}">
    <text class="stats-text">共 {{records.length}} 条记录</text>
    <text class="filter-text" wx:if="{{filterStyle !== 'all'}}">
      当前筛选: {{filterStyleName}}
    </text>
  </view>

  <!-- 记录列表 -->
  <view class="records-list" wx:if="{{records.length > 0}}">
    <view 
      class="record-item" 
      wx:for="{{records}}" 
      wx:key="_id"
      data-index="{{index}}"
      bindtap="viewRecord"
    >
      <!-- 记录头部 -->
      <view class="record-header">
        <view class="record-info">
          <text class="record-style">{{item.style || '未知风格'}}</text>
          <text class="record-time">{{item.formattedTime}}</text>
        </view>
        <view class="record-actions">
          <view 
            class="action-btn-small"
            data-index="{{index}}"
            bindtap="copyContent"
          >
            <text class="action-icon-small">📋</text>
          </view>
          <view 
            class="action-btn-small"
            data-index="{{index}}"
            bindtap="shareContent"
          >
            <text class="action-icon-small">📤</text>
          </view>
          <view 
            class="action-btn-small delete"
            data-index="{{index}}"
            bindtap="deleteRecord"
          >
            <text class="action-icon-small">🗑️</text>
          </view>
        </view>
      </view>

      <!-- 图片预览 -->
      <view class="record-image" wx:if="{{item.imageUrl}}">
        <image 
          class="preview-image" 
          src="{{item.imageUrl}}" 
          mode="aspectFill"
          lazy-load
        />
      </view>

      <!-- 文案内容 -->
      <view class="record-content">
        <text class="content-text">{{item.content}}</text>
      </view>

      <!-- 标签 -->
      <view class="record-tags" wx:if="{{item.tags && item.tags.length > 0}}">
        <text 
          class="tag" 
          wx:for="{{item.tags}}" 
          wx:for-item="tag" 
          wx:key="*this"
        >
          #{{tag}}
        </text>
      </view>

      <!-- 记录底部信息 -->
      <view class="record-footer">
        <view class="footer-info">
          <text class="info-item" wx:if="{{item.description}}">
            💭 {{item.description}}
          </text>
          <text class="info-item" wx:if="{{item.saved}}">
            ⭐ 已保存
          </text>
        </view>
      </view>
    </view>
  </view>

  <!-- 加载更多 -->
  <view class="load-more" wx:if="{{hasMore && records.length > 0}}">
    <view class="loading" wx:if="{{loading}}">
      <text class="loading-text">加载中...</text>
    </view>
    <view class="load-more-btn" wx:else bindtap="loadMoreRecords">
      <text>加载更多</text>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{!loading && records.length === 0}}">
    <view class="empty-icon">📝</view>
    <view class="empty-title">暂无历史记录</view>
    <view class="empty-desc">
      <text wx:if="{{filterStyle !== 'all'}}">当前筛选条件下没有找到记录</text>
      <text wx:else>开始创作你的第一条文案吧</text>
    </view>
    <view class="empty-actions">
      <button 
        class="btn btn-primary"
        wx:if="{{filterStyle !== 'all'}}"
        bindtap="refreshRecords"
      >
        清除筛选
      </button>
      <button 
        class="btn btn-primary"
        wx:else
        bindtap="goToGenerate"
      >
        开始创作
      </button>
    </view>
  </view>

  <!-- 全局加载状态 -->
  <view class="global-loading" wx:if="{{loading && records.length === 0}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>
</view>