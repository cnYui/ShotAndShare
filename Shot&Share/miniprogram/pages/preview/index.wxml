<!--preview.wxml-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- è®°å½•è¯¦æƒ… -->
  <view class="preview-content" wx:if="{{!loading && record}}">
    <!-- å¤´éƒ¨ä¿¡æ¯ -->
    <view class="header-info">
      <view class="style-info">
        <text class="style-name">{{record.styleName || 'æœªçŸ¥é£æ ¼'}}</text>
        <text class="create-time">{{formatTime(record.createdAt)}}</text>
      </view>
      <view class="status-info">
        <text class="status-item" wx:if="{{record.saved}}">
          â­ å·²ä¿å­˜
        </text>
        <text class="status-item" wx:if="{{record.shared}}">
          ğŸ“¤ å·²åˆ†äº«
        </text>
      </view>
    </view>

    <!-- å›¾ç‰‡å±•ç¤º -->
    <view class="image-section" wx:if="{{record.imageUrl}}">
      <view class="image-container">
        <image 
          class="preview-image" 
          src="{{record.imageUrl}}" 
          mode="aspectFit"
          bindload="onImageLoad"
          binderror="onImageError"
          bindtap="previewImage"
        />
        <view class="image-overlay" wx:if="{{!imageLoaded}}">
          <text class="loading-text">å›¾ç‰‡åŠ è½½ä¸­...</text>
        </view>
      </view>
      <view class="image-tip">
        <text>ç‚¹å‡»å›¾ç‰‡å¯æ”¾å¤§æŸ¥çœ‹</text>
      </view>
    </view>

    <!-- ç”¨æˆ·æè¿° -->
    <view class="description-section" wx:if="{{record.description}}">
      <view class="section-title">
        <text class="title-icon">ğŸ’­</text>
        <text class="title-text">ç”¨æˆ·æè¿°</text>
      </view>
      <view class="description-content">
        <text class="description-text">{{record.description}}</text>
      </view>
    </view>

    <!-- æ–‡æ¡ˆå†…å®¹ -->
    <view class="content-section">
      <view class="section-title">
        <text class="title-icon">âœ¨</text>
        <text class="title-text">ç”Ÿæˆæ–‡æ¡ˆ</text>
      </view>
      <view class="content-container">
        <text class="content-text" selectable>{{record.content}}</text>
      </view>
    </view>

    <!-- æ ‡ç­¾ -->
    <view class="tags-section" wx:if="{{record.tags && record.tags.length > 0}}">
      <view class="section-title">
        <text class="title-icon">ğŸ·ï¸</text>
        <text class="title-text">ç›¸å…³æ ‡ç­¾</text>
      </view>
      <view class="tags-container">
        <text 
          class="tag" 
          wx:for="{{record.tags}}" 
          wx:key="*this"
        >
          #{{item}}
        </text>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="actions-section">
      <view class="primary-actions">
        <button 
          class="action-btn primary"
          bindtap="copyContent"
        >
          <text class="btn-icon">ğŸ“‹</text>
          <text class="btn-text">å¤åˆ¶æ–‡æ¡ˆ</text>
        </button>
        <button 
          class="action-btn primary"
          bindtap="shareContent"
        >
          <text class="btn-icon">ğŸ“¤</text>
          <text class="btn-text">åˆ†äº«æ–‡æ¡ˆ</text>
        </button>
      </view>
      
      <view class="secondary-actions">
        <button 
          class="action-btn secondary"
          bindtap="saveRecord"
          disabled="{{record.saved}}"
        >
          <text class="btn-icon">â­</text>
          <text class="btn-text">{{record.saved ? 'å·²ä¿å­˜' : 'ä¿å­˜'}}</text>
        </button>
        <button 
          class="action-btn secondary"
          bindtap="regenerate"
        >
          <text class="btn-icon">ğŸ”„</text>
          <text class="btn-text">é‡æ–°ç”Ÿæˆ</text>
        </button>
      </view>
      
      <view class="danger-actions">
        <button 
          class="action-btn danger"
          bindtap="deleteRecord"
        >
          <text class="btn-icon">ğŸ—‘ï¸</text>
          <text class="btn-text">åˆ é™¤è®°å½•</text>
        </button>
      </view>
    </view>

    <!-- è¯¦ç»†ä¿¡æ¯ -->
    <view class="details-section">
      <view class="section-title">
        <text class="title-icon">â„¹ï¸</text>
        <text class="title-text">è¯¦ç»†ä¿¡æ¯</text>
      </view>
      <view class="details-list">
        <view class="detail-item">
          <text class="detail-label">åˆ›å»ºæ—¶é—´</text>
          <text class="detail-value">{{formatTime(record.createdAt)}}</text>
        </view>
        <view class="detail-item" wx:if="{{record.savedAt}}">
          <text class="detail-label">ä¿å­˜æ—¶é—´</text>
          <text class="detail-value">{{formatTime(record.savedAt)}}</text>
        </view>
        <view class="detail-item" wx:if="{{record.sharedAt}}">
          <text class="detail-label">åˆ†äº«æ—¶é—´</text>
          <text class="detail-value">{{formatTime(record.sharedAt)}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">æ–‡æ¡ˆé£æ ¼</text>
          <text class="detail-value">{{record.styleName || 'æœªçŸ¥'}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">å­—æ•°ç»Ÿè®¡</text>
          <text class="detail-value">{{record.content.length}}å­—</text>
        </view>
      </view>
    </view>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-state" wx:if="{{!loading && !record}}">
    <view class="error-icon">ğŸ˜•</view>
    <view class="error-title">è®°å½•ä¸å­˜åœ¨</view>
    <view class="error-desc">è¯¥è®°å½•å¯èƒ½å·²è¢«åˆ é™¤æˆ–ä¸å­˜åœ¨</view>
    <button class="btn btn-primary" bindtap="goBack">
      è¿”å›ä¸Šä¸€é¡µ
    </button>
  </view>
</view>