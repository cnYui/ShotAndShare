# 前端架构实现详解

## 目录结构设计

### 整体架构

```
miniprogram/
├── app.js                    # 应用入口，全局配置和生命周期
├── app.json                  # 小程序配置文件
├── app.wxss                  # 全局样式文件
├── envList.js               # 环境配置文件
├── sitemap.json             # 搜索优化配置
├── pages/                   # 页面目录
│   ├── home/                # 宠物主页
│   │   ├── home.js         # 页面逻辑
│   │   ├── home.json       # 页面配置
│   │   ├── home.wxml       # 页面结构
│   │   └── home.wxss       # 页面样式
│   ├── tasks/               # 健康任务页面
│   ├── chat/                # AI聊天页面
│   ├── data/                # 健康数据页面
│   ├── profile/             # 个人设置页面
│   ├── login/               # 登录页面
│   └── test/                # 测试页面
├── components/              # 自定义组件
│   └── cloudTipModal/       # 云开发提示组件
├── utils/                   # 工具函数库
│   ├── themeManager.js      # 主题管理器
│   └── util.js              # 通用工具函数
├── i18n/                    # 国际化语言包
│   ├── index.js             # 国际化管理器
│   ├── zh-cn.js             # 简体中文
│   ├── zh-tw.js             # 繁体中文
│   └── en.js                # 英文
└── images/                  # 静态资源
    └── icons/               # 图标资源
```

## 核心模块实现

### 1. 应用入口 (app.js)

#### 全局配置和初始化

```javascript
// app.js
const i18n = require('./i18n/index');
const themeManager = require('./utils/themeManager');

App({
  // 全局数据
  globalData: {
    userInfo: null,
    petInfo: null,
    isLoggedIn: false,
    currentTheme: 'auto',
    currentLanguage: 'zh-cn'
  },

  // 应用启动生命周期
  onLaunch() {
    console.log('应用启动');
    
    // 初始化云开发
    this.initCloudBase();
    
    // 初始化主题和语言
    this.initThemeAndLanguage();
    
    // 检查登录状态
    this.checkLoginStatus();
  },

  // 云开发初始化
  initCloudBase() {
    if (!wx.cloud) {
      console.error('请使用 2.2.3 或以上的基础库以使用云能力');
      return;
    }
    
    wx.cloud.init({
      env: 'your-env-id', // 替换为实际的环境ID
      traceUser: true
    });
  },

  // 初始化主题和语言
  initThemeAndLanguage() {
    // 初始化主题管理器
    themeManager.init();
    this.globalData.currentTheme = themeManager.getCurrentTheme();
    
    // 初始化国际化
    const savedLanguage = wx.getStorageSync('language') || 'zh-cn';
    i18n.setLanguage(savedLanguage);
    this.globalData.currentLanguage = savedLanguage;
  },

  // 检查登录状态
  checkLoginStatus() {
    const userInfo = wx.getStorageSync('userInfo');
    if (userInfo) {
      this.globalData.userInfo = userInfo;
      this.globalData.isLoggedIn = true;
    }
  }
});
```

### 2. 国际化系统实现

#### 国际化管理器 (i18n/index.js)

```javascript
// i18n/index.js
class I18n {
  constructor() {
    this.currentLanguage = 'zh-cn';
    this.texts = {};
    this.observers = [];
    this.loadLanguage(this.currentLanguage);
  }

  // 加载语言包
  loadLanguage(language) {
    try {
      this.texts = require(`./${language}.js`);
      this.currentLanguage = language;
      console.log(`语言包加载成功: ${language}`);
      
      // 通知观察者语言已切换
      this.notifyObservers();
    } catch (error) {
      console.error(`语言包加载失败: ${language}`, error);
      // 回退到默认语言
      if (language !== 'zh-cn') {
        this.loadLanguage('zh-cn');
      }
    }
  }

  // 设置语言
  setLanguage(language) {
    if (language !== this.currentLanguage) {
      this.loadLanguage(language);
      wx.setStorageSync('language', language);
      
      // 更新全局数据
      const app = getApp();
      if (app) {
        app.globalData.currentLanguage = language;
      }
    }
  }

  // 获取文本
  getText(key, params = {}) {
    const keys = key.split('.');
    let text = this.texts;
    
    // 逐级查找文本
    for (const k of keys) {
      text = text[k];
      if (!text) {
        console.warn(`国际化文本未找到: ${key}`);
        return key; // 返回key作为备用
      }
    }
    
    // 如果是字符串，进行参数替换
    if (typeof text === 'string') {
      return this.replaceParams(text, params);
    }
    
    return text;
  }

  // 参数替换
  replaceParams(text, params) {
    return text.replace(/\{(\w+)\}/g, (match, key) => {
      return params[key] !== undefined ? params[key] : match;
    });
  }

  // 添加观察者
  addObserver(callback) {
    this.observers.push(callback);
  }

  // 移除观察者
  removeObserver(callback) {
    const index = this.observers.indexOf(callback);
    if (index > -1) {
      this.observers.splice(index, 1);
    }
  }

  // 通知观察者
  notifyObservers() {
    this.observers.forEach(callback => {
      try {
        callback(this.currentLanguage, this.texts);
      } catch (error) {
        console.error('国际化观察者回调执行失败:', error);
      }
    });
  }

  // 获取当前语言
  getCurrentLanguage() {
    return this.currentLanguage;
  }

  // 获取所有文本
  getAllTexts() {
    return this.texts;
  }
}

// 创建单例实例
const i18n = new I18n();

module.exports = i18n;
```

#### 语言包结构 (zh-cn.js)

```javascript
// i18n/zh-cn.js
module.exports = {
  // 通用文本
  common: {
    confirm: '确认',
    cancel: '取消',
    save: '保存',
    edit: '编辑',
    delete: '删除',
    loading: '加载中...',
    success: '成功',
    error: '错误',
    retry: '重试',
    back: '返回'
  },
  
  // 登录页面
  login: {
    appName: '健康宠物伴侣',
    wechatLogin: '微信登录',
    continueUse: '继续使用',
    loggingIn: '登录中...',
    authRequired: '需要授权才能使用',
    loginSuccess: '登录成功',
    registerSuccess: '注册成功',
    loginFailed: '登录失败，请重试'
  },
  
  // 主页
  home: {
    title: '健康宠物伴侣',
    welcome: '欢迎回来',
    petName: '小绿',
    petLevel: 'Lv.{level}',
    petStatus: '宠物状态',
    petMood: {
      veryHappy: '非常开心',
      happy: '开心',
      normal: '一般',
      needCare: '需要关爱'
    },
    stats: {
      health: '健康值',
      happiness: '快乐值',
      energy: '活力值',
      experience: '经验值'
    },
    actions: {
      feed: '喂食',
      play: '玩耍',
      exercise: '运动',
      rest: '休息'
    },
    todayData: '今日数据',
    quickActions: '快捷操作'
  }
  // ... 其他页面的文本
};
```

### 3. 主题系统实现

#### 主题管理器 (utils/themeManager.js)

```javascript
// utils/themeManager.js
class ThemeManager {
  constructor() {
    this.currentTheme = 'auto'; // auto, light, dark
    this.isDarkMode = false;
    this.observers = [];
    this.systemThemeListener = null;
  }

  // 初始化主题管理器
  init() {
    // 从缓存中读取主题设置
    const savedTheme = wx.getStorageSync('theme') || 'auto';
    this.setTheme(savedTheme, false);
    
    // 监听系统主题变化
    this.listenSystemTheme();
  }

  // 设置主题
  setTheme(theme, save = true) {
    this.currentTheme = theme;
    
    // 计算是否为深色模式
    if (theme === 'auto') {
      this.updateSystemTheme();
    } else {
      this.isDarkMode = theme === 'dark';
    }
    
    // 保存到缓存
    if (save) {
      wx.setStorageSync('theme', theme);
    }
    
    // 更新全局数据
    const app = getApp();
    if (app) {
      app.globalData.currentTheme = theme;
    }
    
    // 通知观察者
    this.notifyObservers();
    
    console.log(`主题已切换: ${theme}, 深色模式: ${this.isDarkMode}`);
  }

  // 更新系统主题
  updateSystemTheme() {
    try {
      const systemInfo = wx.getSystemInfoSync();
      this.isDarkMode = systemInfo.theme === 'dark';
    } catch (error) {
      console.error('获取系统主题失败:', error);
      this.isDarkMode = false;
    }
  }

  // 监听系统主题变化
  listenSystemTheme() {
    if (wx.onThemeChange) {
      this.systemThemeListener = (res) => {
        if (this.currentTheme === 'auto') {
          this.isDarkMode = res.theme === 'dark';
          this.notifyObservers();
        }
      };
      wx.onThemeChange(this.systemThemeListener);
    }
  }

  // 获取当前主题
  getCurrentTheme() {
    return this.currentTheme;
  }

  // 是否为深色模式
  getIsDarkMode() {
    return this.isDarkMode;
  }

  // 获取主题类名
  getThemeClass() {
    return this.isDarkMode ? 'theme-dark' : 'theme-light';
  }

  // 添加观察者
  addObserver(callback) {
    this.observers.push(callback);
  }

  // 移除观察者
  removeObserver(callback) {
    const index = this.observers.indexOf(callback);
    if (index > -1) {
      this.observers.splice(index, 1);
    }
  }

  // 通知观察者
  notifyObservers() {
    this.observers.forEach(callback => {
      try {
        callback(this.currentTheme, this.isDarkMode);
      } catch (error) {
        console.error('主题观察者回调执行失败:', error);
      }
    });
  }

  // 销毁
  destroy() {
    if (this.systemThemeListener && wx.offThemeChange) {
      wx.offThemeChange(this.systemThemeListener);
    }
    this.observers = [];
  }
}

// 创建单例实例
const themeManager = new ThemeManager();

module.exports = themeManager;
```

### 4. 页面基类实现

#### 页面通用逻辑抽象

```javascript
// utils/basePage.js
const i18n = require('../i18n/index');
const themeManager = require('./themeManager');

// 页面基类混入
const PageMixin = {
  data: {
    isDarkMode: false,
    themeClass: 'theme-light',
    texts: {},
    loading: false
  },

  // 页面显示时
  onShow() {
    this.initThemeAndLanguage();
  },

  // 初始化主题和语言
  initThemeAndLanguage() {
    // 加载文本
    this.loadTexts();
    
    // 应用当前主题
    this.applyCurrentTheme();
    
    // 添加观察者
    this.addObservers();
  },

  // 加载文本
  loadTexts() {
    const texts = i18n.getAllTexts();
    this.setData({ texts });
  },

  // 应用当前主题
  applyCurrentTheme() {
    const isDarkMode = themeManager.getIsDarkMode();
    const themeClass = themeManager.getThemeClass();
    
    this.setData({
      isDarkMode,
      themeClass
    });
  },

  // 添加观察者
  addObservers() {
    // 主题变化观察者
    this.themeObserver = (theme, isDarkMode) => {
      this.setData({
        isDarkMode,
        themeClass: themeManager.getThemeClass()
      });
    };
    themeManager.addObserver(this.themeObserver);
    
    // 语言变化观察者
    this.languageObserver = (language, texts) => {
      this.setData({ texts });
    };
    i18n.addObserver(this.languageObserver);
  },

  // 移除观察者
  removeObservers() {
    if (this.themeObserver) {
      themeManager.removeObserver(this.themeObserver);
    }
    if (this.languageObserver) {
      i18n.removeObserver(this.languageObserver);
    }
  },

  // 页面卸载时
  onUnload() {
    this.removeObservers();
  },

  // 显示加载状态
  showLoading(title = '加载中...') {
    this.setData({ loading: true });
    wx.showLoading({ title });
  },

  // 隐藏加载状态
  hideLoading() {
    this.setData({ loading: false });
    wx.hideLoading();
  },

  // 显示成功提示
  showSuccess(title) {
    wx.showToast({
      title,
      icon: 'success',
      duration: 2000
    });
  },

  // 显示错误提示
  showError(title) {
    wx.showToast({
      title,
      icon: 'error',
      duration: 2000
    });
  }
};

module.exports = PageMixin;
```

### 5. 页面实现示例

#### 主页实现 (pages/home/home.js)

```javascript
// pages/home/home.js
const i18n = require('../../i18n/index');
const themeManager = require('../../utils/themeManager');
const PageMixin = require('../../utils/basePage');

Page({
  // 混入基类
  ...PageMixin,

  data: {
    ...PageMixin.data,
    userInfo: null,
    petInfo: {
      name: '小绿',
      level: 1,
      experience: 0,
      health: 80,
      happiness: 75,
      energy: 90,
      mood: 'happy',
      avatar: '/images/pet-avatar.png'
    },
    todayData: {
      steps: 0,
      water: 0,
      sleep: 0,
      exercise: 0
    },
    quickActions: [
      { id: 'feed', icon: 'feed', action: 'feedPet' },
      { id: 'play', icon: 'play', action: 'playWithPet' },
      { id: 'exercise', icon: 'exercise', action: 'exerciseWithPet' },
      { id: 'rest', icon: 'rest', action: 'restWithPet' }
    ]
  },

  onLoad() {
    console.log('主页加载');
    this.initPage();
  },

  // 初始化页面
  async initPage() {
    this.showLoading();
    
    try {
      // 获取用户信息
      await this.loadUserInfo();
      
      // 获取宠物信息
      await this.loadPetInfo();
      
      // 获取今日数据
      await this.loadTodayData();
      
    } catch (error) {
      console.error('页面初始化失败:', error);
      this.showError('加载失败，请重试');
    } finally {
      this.hideLoading();
    }
  },

  // 加载用户信息
  async loadUserInfo() {
    const app = getApp();
    if (app.globalData.userInfo) {
      this.setData({
        userInfo: app.globalData.userInfo
      });
    } else {
      // 重定向到登录页
      wx.redirectTo({
        url: '/pages/login/login'
      });
    }
  },

  // 加载宠物信息
  async loadPetInfo() {
    try {
      const result = await wx.cloud.callFunction({
        name: 'petManager',
        data: {
          action: 'get'
        }
      });
      
      if (result.result.success) {
        this.setData({
          petInfo: result.result.petInfo
        });
      }
    } catch (error) {
      console.error('获取宠物信息失败:', error);
    }
  },

  // 加载今日数据
  async loadTodayData() {
    try {
      const result = await wx.cloud.callFunction({
        name: 'healthDataManager',
        data: {
          action: 'getTodayData'
        }
      });
      
      if (result.result.success) {
        this.setData({
          todayData: result.result.data
        });
      }
    } catch (error) {
      console.error('获取今日数据失败:', error);
    }
  },

  // 宠物互动 - 喂食
  async feedPet() {
    await this.petAction('feed', {
      health: 5,
      happiness: 3,
      experience: 10
    });
  },

  // 宠物互动 - 玩耍
  async playWithPet() {
    await this.petAction('play', {
      happiness: 8,
      energy: -5,
      experience: 15
    });
  },

  // 宠物互动 - 运动
  async exerciseWithPet() {
    await this.petAction('exercise', {
      health: 8,
      energy: -10,
      experience: 20
    });
  },

  // 宠物互动 - 休息
  async restWithPet() {
    await this.petAction('rest', {
      energy: 15,
      experience: 5
    });
  },

  // 执行宠物动作
  async petAction(action, effects) {
    this.showLoading('互动中...');
    
    try {
      const result = await wx.cloud.callFunction({
        name: 'petManager',
        data: {
          action: 'interact',
          interactionType: action,
          effects
        }
      });
      
      if (result.result.success) {
        // 更新宠物信息
        this.setData({
          petInfo: result.result.petInfo
        });
        
        // 显示互动结果
        const actionText = this.data.texts.home?.actions?.[action] || action;
        this.showSuccess(`${actionText}成功！`);
        
        // 播放动画效果
        this.playInteractionAnimation(action);
      }
    } catch (error) {
      console.error('宠物互动失败:', error);
      this.showError('互动失败，请重试');
    } finally {
      this.hideLoading();
    }
  },

  // 播放互动动画
  playInteractionAnimation(action) {
    // 实现动画逻辑
    const animation = wx.createAnimation({
      duration: 500,
      timingFunction: 'ease-in-out'
    });
    
    animation.scale(1.1).step();
    animation.scale(1).step();
    
    this.setData({
      petAnimation: animation.export()
    });
  },

  // 下拉刷新
  async onPullDownRefresh() {
    try {
      await this.initPage();
    } finally {
      wx.stopPullDownRefresh();
    }
  },

  // 分享
  onShareAppMessage() {
    const texts = this.data.texts;
    return {
      title: texts.home?.title || '健康宠物伴侣',
      path: '/pages/home/home',
      imageUrl: '/images/share-image.png'
    };
  }
});
```

### 6. 样式系统实现

#### 全局样式 (app.wxss)

```css
/* app.wxss */
/* 全局样式重置 */
* {
  box-sizing: border-box;
}

page {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
  line-height: 1.6;
  color: var(--text-color);
  background-color: var(--bg-color);
}

/* CSS 变量定义 */
:root {
  /* 浅色主题 */
  --primary-color: #A3D39C;
  --secondary-color: #FF9F55;
  --accent-color: #4CAF50;
  --text-color: #333333;
  --text-secondary: #666666;
  --text-muted: #999999;
  --bg-color: #ffffff;
  --bg-secondary: #f5f5f5;
  --border-color: #e0e0e0;
  --shadow-color: rgba(0, 0, 0, 0.1);
}

/* 深色主题 */
.theme-dark {
  --primary-color: #7CB342;
  --secondary-color: #FF8A65;
  --accent-color: #66BB6A;
  --text-color: #ffffff;
  --text-secondary: #cccccc;
  --text-muted: #999999;
  --bg-color: #121212;
  --bg-secondary: #1e1e1e;
  --border-color: #333333;
  --shadow-color: rgba(255, 255, 255, 0.1);
}

/* 通用组件样式 */
.container {
  padding: 20rpx;
  min-height: 100vh;
  background-color: var(--bg-color);
}

.card {
  background-color: var(--bg-color);
  border-radius: 16rpx;
  padding: 24rpx;
  margin-bottom: 20rpx;
  box-shadow: 0 4rpx 12rpx var(--shadow-color);
  border: 1rpx solid var(--border-color);
}

.btn {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 24rpx 48rpx;
  border-radius: 12rpx;
  font-size: 32rpx;
  font-weight: 500;
  transition: all 0.3s ease;
  border: none;
  outline: none;
}

.btn-primary {
  background-color: var(--primary-color);
  color: white;
}

.btn-primary:active {
  background-color: var(--accent-color);
  transform: scale(0.98);
}

.btn-secondary {
  background-color: var(--secondary-color);
  color: white;
}

.text-primary {
  color: var(--primary-color);
}

.text-secondary {
  color: var(--text-secondary);
}

.text-muted {
  color: var(--text-muted);
}

/* 动画类 */
.fade-in {
  animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20rpx);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.scale-in {
  animation: scaleIn 0.3s ease-out;
}

@keyframes scaleIn {
  from {
    opacity: 0;
    transform: scale(0.9);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

/* 响应式设计 */
@media (max-width: 750rpx) {
  .container {
    padding: 16rpx;
  }
  
  .card {
    padding: 20rpx;
  }
}
```

#### 页面样式示例 (pages/home/home.wxss)

```css
/* pages/home/home.wxss */
.home-container {
  padding: 0;
  background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
  min-height: 100vh;
}

.header {
  padding: 40rpx 30rpx 30rpx;
  color: white;
}

.welcome-text {
  font-size: 28rpx;
  opacity: 0.9;
  margin-bottom: 10rpx;
}

.user-name {
  font-size: 36rpx;
  font-weight: bold;
}

.pet-card {
  margin: 20rpx;
  background: white;
  border-radius: 24rpx;
  padding: 30rpx;
  position: relative;
  overflow: hidden;
}

.pet-info {
  display: flex;
  align-items: center;
  margin-bottom: 30rpx;
}

.pet-avatar {
  width: 120rpx;
  height: 120rpx;
  border-radius: 60rpx;
  margin-right: 24rpx;
  border: 4rpx solid var(--primary-color);
}

.pet-details {
  flex: 1;
}

.pet-name {
  font-size: 32rpx;
  font-weight: bold;
  color: var(--text-color);
  margin-bottom: 8rpx;
}

.pet-level {
  font-size: 24rpx;
  color: var(--primary-color);
  margin-bottom: 8rpx;
}

.pet-mood {
  font-size: 24rpx;
  color: var(--text-secondary);
}

.stats-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20rpx;
  margin-bottom: 30rpx;
}

.stat-item {
  text-align: center;
  padding: 20rpx;
  background: var(--bg-secondary);
  border-radius: 12rpx;
}

.stat-value {
  font-size: 32rpx;
  font-weight: bold;
  color: var(--primary-color);
  margin-bottom: 8rpx;
}

.stat-label {
  font-size: 24rpx;
  color: var(--text-secondary);
}

.progress-bar {
  width: 100%;
  height: 8rpx;
  background: var(--bg-secondary);
  border-radius: 4rpx;
  overflow: hidden;
  margin-top: 8rpx;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
  border-radius: 4rpx;
  transition: width 0.3s ease;
}

.actions-section {
  margin: 20rpx;
}

.section-title {
  font-size: 32rpx;
  font-weight: bold;
  color: var(--text-color);
  margin-bottom: 20rpx;
  padding: 0 10rpx;
}

.actions-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16rpx;
}

.action-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 30rpx 20rpx;
  background: white;
  border-radius: 16rpx;
  box-shadow: 0 4rpx 12rpx var(--shadow-color);
  transition: all 0.3s ease;
}

.action-btn:active {
  transform: scale(0.95);
  box-shadow: 0 2rpx 8rpx var(--shadow-color);
}

.action-icon {
  width: 60rpx;
  height: 60rpx;
  margin-bottom: 12rpx;
}

.action-text {
  font-size: 28rpx;
  color: var(--text-color);
  font-weight: 500;
}

.data-overview {
  margin: 20rpx;
  background: white;
  border-radius: 16rpx;
  padding: 24rpx;
}

.data-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20rpx;
}

.data-item {
  text-align: center;
  padding: 16rpx;
  background: var(--bg-secondary);
  border-radius: 12rpx;
}

.data-value {
  font-size: 28rpx;
  font-weight: bold;
  color: var(--secondary-color);
  margin-bottom: 8rpx;
}

.data-label {
  font-size: 22rpx;
  color: var(--text-secondary);
}

/* 动画效果 */
.pet-avatar {
  transition: transform 0.3s ease;
}

.pet-interaction {
  animation: petBounce 0.6s ease-in-out;
}

@keyframes petBounce {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.1);
  }
}

/* 深色主题适配 */
.theme-dark .pet-card,
.theme-dark .action-btn,
.theme-dark .data-overview {
  background: var(--bg-secondary);
  border: 1rpx solid var(--border-color);
}

.theme-dark .stat-item,
.theme-dark .data-item {
  background: var(--bg-color);
}
```

## 性能优化策略

### 1. 代码分包

```json
// app.json
{
  "pages": [
    "pages/home/home",
    "pages/login/login"
  ],
  "subPackages": [
    {
      "root": "packages/features",
      "pages": [
        "tasks/tasks",
        "chat/chat",
        "data/data",
        "profile/profile"
      ]
    }
  ],
  "preloadRule": {
    "pages/home/home": {
      "network": "all",
      "packages": ["packages/features"]
    }
  }
}
```

### 2. 图片优化

```javascript
// 图片懒加载组件
Component({
  properties: {
    src: String,
    width: String,
    height: String
  },
  
  data: {
    loaded: false,
    error: false
  },
  
  methods: {
    onLoad() {
      this.setData({ loaded: true });
    },
    
    onError() {
      this.setData({ error: true });
    }
  }
});
```

### 3. 数据缓存策略

```javascript
// 缓存管理器
class CacheManager {
  constructor() {
    this.cache = new Map();
    this.expireTime = 5 * 60 * 1000; // 5分钟
  }
  
  set(key, data) {
    this.cache.set(key, {
      data,
      timestamp: Date.now()
    });
  }
  
  get(key) {
    const item = this.cache.get(key);
    if (!item) return null;
    
    if (Date.now() - item.timestamp > this.expireTime) {
      this.cache.delete(key);
      return null;
    }
    
    return item.data;
  }
  
  clear() {
    this.cache.clear();
  }
}
```

## 总结

前端架构的核心特点：

1. **模块化设计**：清晰的目录结构和模块划分
2. **国际化支持**：完整的多语言解决方案
3. **主题系统**：灵活的主题切换机制
4. **组件化开发**：可复用的组件和页面基类
5. **性能优化**：代码分包、懒加载、缓存策略
6. **用户体验**：流畅的动画和交互效果

这个架构为小程序提供了良好的可维护性、可扩展性和用户体验。