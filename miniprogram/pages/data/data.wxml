<!--健康数据页面-->
<view class="data-container">
  <!-- 顶部数据概览 -->
  <view class="overview-section">
    <view class="overview-card">
      <view class="overview-header">
        <text class="overview-title">今日数据概览</text>
        <text class="overview-date">{{currentDate}}</text>
      </view>
      
      <view class="overview-stats">
        <view class="stat-item">
          <view class="stat-icon steps">
            <image src="/images/icons/steps.png"></image>
          </view>
          <view class="stat-info">
            <text class="stat-value">{{todayData.steps || 0}}</text>
            <text class="stat-label">步数</text>
          </view>
        </view>
        
        <view class="stat-item">
          <view class="stat-icon water">
            <image src="/images/icons/water.png"></image>
          </view>
          <view class="stat-info">
            <text class="stat-value">{{todayData.water || 0}}ml</text>
            <text class="stat-label">饮水</text>
          </view>
        </view>
        
        <view class="stat-item">
          <view class="stat-icon sleep">
            <image src="/images/icons/sleep.png"></image>
          </view>
          <view class="stat-info">
            <text class="stat-value">{{todayData.sleep || 0}}h</text>
            <text class="stat-label">睡眠</text>
          </view>
        </view>
        
        <view class="stat-item">
          <view class="stat-icon exercise">
            <image src="/images/icons/exercise.png"></image>
          </view>
          <view class="stat-info">
            <text class="stat-value">{{todayData.exercise || 0}}min</text>
            <text class="stat-label">运动</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 数据分类标签 -->
  <view class="category-tabs">
    <view class="tab-item {{currentTab === 'steps' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="steps">
      <image class="tab-icon" src="/images/icons/steps.png"></image>
      <text>步数</text>
    </view>
    <view class="tab-item {{currentTab === 'water' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="water">
      <image class="tab-icon" src="/images/icons/water.png"></image>
      <text>饮水</text>
    </view>
    <view class="tab-item {{currentTab === 'sleep' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="sleep">
      <image class="tab-icon" src="/images/icons/sleep.png"></image>
      <text>睡眠</text>
    </view>
    <view class="tab-item {{currentTab === 'exercise' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="exercise">
      <image class="tab-icon" src="/images/icons/exercise.png"></image>
      <text>运动</text>
    </view>
  </view>

  <!-- 时间范围选择 -->
  <view class="time-range-section">
    <view class="range-tabs">
      <view class="range-tab {{currentRange === 'day' ? 'active' : ''}}" 
            bindtap="switchRange" data-range="day">
        <text>日</text>
      </view>
      <view class="range-tab {{currentRange === 'week' ? 'active' : ''}}" 
            bindtap="switchRange" data-range="week">
        <text>周</text>
      </view>
      <view class="range-tab {{currentRange === 'month' ? 'active' : ''}}" 
            bindtap="switchRange" data-range="month">
        <text>月</text>
      </view>
    </view>
  </view>

  <!-- 数据详情区域 -->
  <view class="data-detail-section">
    <!-- 步数数据 -->
    <view class="data-card" wx:if="{{currentTab === 'steps'}}">
      <view class="card-header">
        <text class="card-title">步数统计</text>
        <view class="card-target">
          <text>目标: {{stepsTarget}}步</text>
        </view>
      </view>
      
      <view class="progress-section">
        <view class="circular-progress">
          <view class="progress-circle">
            <view class="progress-fill" style="--progress: {{stepsProgress}}%"></view>
            <view class="progress-content">
              <text class="progress-value">{{todayData.steps}}</text>
              <text class="progress-unit">步</text>
            </view>
          </view>
        </view>
        <view class="progress-info">
          <text class="completion-rate">完成度: {{Math.round(stepsProgress)}}%</text>
          <text class="remaining">还需: {{stepsTarget - todayData.steps}}步</text>
        </view>
      </view>
      
      <view class="chart-container">
        <canvas class="data-chart" canvas-id="stepsChart" disable-scroll="true"></canvas>
      </view>
      
      <view class="data-insights">
        <text class="insights-title">数据洞察</text>
        <text class="insights-content">{{stepsInsights}}</text>
      </view>
    </view>

    <!-- 饮水数据 -->
    <view class="data-card" wx:if="{{currentTab === 'water'}}">
      <view class="card-header">
        <text class="card-title">饮水记录</text>
        <view class="card-target">
          <text>目标: {{waterTarget}}ml</text>
        </view>
      </view>
      
      <view class="water-progress">
        <view class="water-bottle">
          <view class="water-level" style="height: {{waterProgress}}%"></view>
          <view class="water-marks">
            <view class="mark" wx:for="{{waterMarks}}" wx:key="index" style="bottom: {{item}}%">
              <text>{{waterTarget * item / 100}}ml</text>
            </view>
          </view>
        </view>
        <view class="water-info">
          <text class="water-current">{{todayData.water}}ml</text>
          <text class="water-remaining">还需: {{waterTarget - todayData.water}}ml</text>
        </view>
      </view>
      
      <view class="water-records">
        <text class="records-title">今日饮水记录</text>
        <view class="record-list">
          <view class="record-item" wx:for="{{waterRecords}}" wx:key="id">
            <view class="record-time">{{item.time}}</view>
            <view class="record-amount">+{{item.amount}}ml</view>
          </view>
        </view>
      </view>
      
      <view class="quick-add-water">
        <text class="add-title">快速添加</text>
        <view class="add-buttons">
          <button class="add-btn" bindtap="addWater" data-amount="200">200ml</button>
          <button class="add-btn" bindtap="addWater" data-amount="300">300ml</button>
          <button class="add-btn" bindtap="addWater" data-amount="500">500ml</button>
          <button class="add-btn custom" bindtap="showCustomWaterInput">自定义</button>
        </view>
      </view>
    </view>

    <!-- 睡眠数据 -->
    <view class="data-card" wx:if="{{currentTab === 'sleep'}}">
      <view class="card-header">
        <text class="card-title">睡眠分析</text>
        <view class="card-target">
          <text>目标: {{sleepTarget}}小时</text>
        </view>
      </view>
      
      <view class="sleep-overview">
        <view class="sleep-time">
          <view class="time-item">
            <text class="time-label">入睡时间</text>
            <text class="time-value">{{sleepData.bedTime || '--:--'}}</text>
          </view>
          <view class="time-item">
            <text class="time-label">起床时间</text>
            <text class="time-value">{{sleepData.wakeTime || '--:--'}}</text>
          </view>
          <view class="time-item">
            <text class="time-label">睡眠时长</text>
            <text class="time-value">{{sleepData.duration || 0}}小时</text>
          </view>
        </view>
      </view>
      
      <view class="sleep-quality">
        <text class="quality-title">睡眠质量</text>
        <view class="quality-score">
          <view class="score-circle">
            <text class="score-value">{{sleepData.quality || 0}}</text>
            <text class="score-unit">分</text>
          </view>
          <view class="quality-desc">
            <text>{{sleepQualityDesc}}</text>
          </view>
        </view>
      </view>
      
      <view class="sleep-phases">
        <text class="phases-title">睡眠阶段</text>
        <view class="phases-chart">
          <view class="phase-item" wx:for="{{sleepPhases}}" wx:key="type">
            <view class="phase-color" style="background: {{item.color}}"></view>
            <text class="phase-name">{{item.name}}</text>
            <text class="phase-duration">{{item.duration}}h</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 运动数据 -->
    <view class="data-card" wx:if="{{currentTab === 'exercise'}}">
      <view class="card-header">
        <text class="card-title">运动统计</text>
        <view class="card-target">
          <text>目标: {{exerciseTarget}}分钟</text>
        </view>
      </view>
      
      <view class="exercise-summary">
        <view class="summary-item">
          <text class="summary-value">{{todayData.exercise}}</text>
          <text class="summary-label">运动时长(分钟)</text>
        </view>
        <view class="summary-item">
          <text class="summary-value">{{exerciseData.calories || 0}}</text>
          <text class="summary-label">消耗卡路里</text>
        </view>
        <view class="summary-item">
          <text class="summary-value">{{exerciseData.heartRate || 0}}</text>
          <text class="summary-label">平均心率</text>
        </view>
      </view>
      
      <view class="exercise-types">
        <text class="types-title">运动类型</text>
        <view class="type-list">
          <view class="type-item" wx:for="{{exerciseTypes}}" wx:key="type">
            <view class="type-icon">
              <image src="/images/icons/{{item.type}}.png"></image>
            </view>
            <view class="type-info">
              <text class="type-name">{{item.name}}</text>
              <text class="type-duration">{{item.duration}}分钟</text>
            </view>
            <view class="type-calories">
              <text>{{item.calories}}卡</text>
            </view>
          </view>
        </view>
      </view>
      
      <view class="exercise-chart">
        <canvas class="data-chart" canvas-id="exerciseChart" disable-scroll="true"></canvas>
      </view>
    </view>
  </view>

  <!-- 数据导出和设置 -->
  <view class="data-actions">
    <button class="action-btn export" bindtap="exportData">
      <image class="btn-icon" src="/images/icons/export.png"></image>
      <text>导出数据</text>
    </button>
    <button class="action-btn sync" bindtap="syncData">
      <image class="btn-icon" src="/images/icons/sync.png"></image>
      <text>同步数据</text>
    </button>
    <button class="action-btn settings" bindtap="openDataSettings">
      <image class="btn-icon" src="/images/icons/settings.png"></image>
      <text>数据设置</text>
    </button>
  </view>

  <!-- 自定义饮水输入弹窗 -->
  <view class="custom-water-modal" wx:if="{{showCustomWaterModal}}">
    <view class="modal-mask" bindtap="hideCustomWaterInput"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">添加饮水量</text>
        <button class="modal-close" bindtap="hideCustomWaterInput">
          <image src="/images/icons/close.png"></image>
        </button>
      </view>
      <view class="modal-body">
        <view class="input-group">
          <input class="water-input" type="number" placeholder="请输入饮水量" 
                 value="{{customWaterAmount}}" bindinput="onCustomWaterInput" />
          <text class="input-unit">ml</text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="hideCustomWaterInput">取消</button>
        <button class="modal-btn confirm" bindtap="confirmCustomWater">确定</button>
      </view>
    </view>
  </view>
</view>