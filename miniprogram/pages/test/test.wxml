<!--pages/test/test.wxml-->
<view class="container">
  <!-- 页面标题 -->
  <view class="header">
    <text class="title">后端功能测试</text>
    <text class="subtitle">验证云函数和数据库是否正常工作</text>
  </view>

  <!-- 测试按钮区域 -->
  <view class="button-section">
    <button 
      class="test-btn primary" 
      bindtap="startFullTest" 
      disabled="{{isLoading}}"
    >
      {{isLoading ? '测试中...' : '开始完整测试'}}
    </button>
    
    <button 
      class="test-btn secondary" 
      bindtap="initDatabaseOnly" 
      disabled="{{isLoading}}"
    >
      初始化数据库
    </button>
    
    <button 
      class="test-btn clear" 
      bindtap="clearResults" 
      disabled="{{isLoading}}"
    >
      清空结果
    </button>
  </view>

  <!-- 测试进度 -->
  <view class="progress-section" wx:if="{{isLoading || testProgress > 0}}">
    <view class="progress-text">{{currentTest}}</view>
    <view class="progress-bar">
      <view class="progress-fill" style="width: {{testProgress}}%"></view>
    </view>
    <view class="progress-percent">{{testProgress}}%</view>
  </view>

  <!-- 测试结果列表 -->
  <view class="results-section" wx:if="{{testResults.length > 0}}">
    <view class="results-header">
      <text class="results-title">测试结果</text>
      <text class="results-count">{{testResults.length}} 项测试</text>
    </view>
    
    <view class="result-item" wx:for="{{testResults}}" wx:key="index">
      <view class="result-header">
        <view class="result-name">
          <text class="status-icon {{item.success ? 'success' : 'fail'}}">{{item.success ? '✅' : '❌'}}</text>
          <text class="test-name">{{item.name}}</text>
        </view>
        <text class="test-time">{{item.time}}</text>
      </view>
      <view class="result-message">{{item.message}}</view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{testResults.length === 0 && !isLoading}}">
    <text class="empty-icon">🧪</text>
    <text class="empty-text">点击上方按钮开始测试</text>
    <text class="empty-desc">测试将验证所有后端功能是否正常工作</text>
  </view>

  <!-- 测试说明 -->
  <view class="info-section">
    <view class="info-title">测试项目说明</view>
    <view class="info-list">
      <view class="info-item">
        <text class="info-label">数据库初始化</text>
        <text class="info-desc">创建用户、宠物、任务等数据表</text>
      </view>
      <view class="info-item">
        <text class="info-label">用户登录</text>
        <text class="info-desc">测试微信登录和用户信息存储</text>
      </view>
      <view class="info-item">
        <text class="info-label">宠物管理</text>
        <text class="info-desc">测试宠物创建和查询功能</text>
      </view>
      <view class="info-item">
        <text class="info-label">任务管理</text>
        <text class="info-desc">测试任务获取和完成功能</text>
      </view>
      <view class="info-item">
        <text class="info-label">智能聊天</text>
        <text class="info-desc">测试AI聊天功能（需要配置API）</text>
      </view>
      <view class="info-item">
        <text class="info-label">健康数据</text>
        <text class="info-desc">测试健康数据的添加和查询</text>
      </view>
    </view>
  </view>
</view>