<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>云函数测试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #007aff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 3px;
            white-space: pre-wrap;
        }
        .error {
            background: #ffe6e6;
            color: #d00;
        }
        .success {
            background: #e6ffe6;
            color: #080;
        }
    </style>
</head>
<body>
    <h1>健康宠物伴侣 - 云函数测试</h1>
    
    <div class="test-section">
        <h3>问题诊断和解决方案</h3>
        <div class="result">
<strong>问题分析：</strong>
1. pet_users数据库为空 - 这是正常的，用户数据在首次登录时创建
2. 云函数找不到错误 - userManager等云函数已部署成功

<strong>解决步骤：</strong>
1. 确保在微信开发者工具中打开项目
2. 在小程序中进行一次完整的登录流程
3. 登录成功后，用户数据会自动创建
4. 如果仍有问题，请检查云开发环境配置

<strong>已部署的云函数：</strong>
- login (用户登录)
- userManager (用户管理)
- petManager (宠物管理)
- taskManager (任务管理)
- analytics (数据分析)
- logError (错误日志)
- initDatabase (数据库初始化)
- petChat (宠物聊天)
- healthDataManager (健康数据管理)
        </div>
    </div>
    
    <div class="test-section">
        <h3>手动测试步骤</h3>
        <div class="result">
<strong>在微信开发者工具中执行以下步骤：</strong>

1. 打开微信开发者工具
2. 导入项目：/Users/wujianxiang/WeChatProjects/healthypetcompanion
3. 确保云开发环境已配置：cloud1-6g4qsd2kcddd1be0
4. 在控制台中执行以下代码测试云函数：

// 测试initDatabase云函数
wx.cloud.callFunction({
  name: 'initDatabase',
  success: res => console.log('initDatabase:', res),
  fail: err => console.error('initDatabase error:', err)
});

// 测试userManager云函数
wx.cloud.callFunction({
  name: 'userManager',
  data: { action: 'getUserStats' },
  success: res => console.log('userManager:', res),
  fail: err => console.error('userManager error:', err)
});

5. 如果云函数调用成功，说明部署正常
6. 进行一次完整的用户登录流程
7. 检查数据库中是否创建了用户记录
        </div>
    </div>
    
    <div class="test-section">
        <h3>常见问题解决</h3>
        <div class="result">
<strong>如果仍然出现"FunctionName parameter could not be found"错误：</strong>

1. 检查云开发环境ID是否正确
2. 确认云函数已正确上传到云端
3. 在微信开发者工具的云开发控制台中查看云函数列表
4. 如果云函数不存在，重新运行部署脚本：
   cd /Users/wujianxiang/WeChatProjects/healthypetcompanion
   ./deploy-cloudfunctions.sh

<strong>如果数据库连接问题：</strong>

1. 检查project.config.json中的云开发环境配置
2. 确保在微信开发者工具中已开通云开发服务
3. 检查云开发控制台中的数据库是否已创建

<strong>如果用户登录问题：</strong>

1. 确保login云函数正常工作
2. 检查用户授权流程
3. 查看控制台错误日志
        </div>
    </div>
    
    <div class="test-section">
        <h3>数据库状态检查</h3>
        <div class="result">
<strong>预期的数据库集合：</strong>
- pet_users (用户信息)
- pets (宠物信息)
- tasks (任务定义)
- task_records (任务记录)
- health_data (健康数据)
- chat_context (聊天上下文)
- error_logs (错误日志)

<strong>检查方法：</strong>
1. 在微信开发者工具中打开云开发控制台
2. 进入数据库管理
3. 查看是否存在上述集合
4. 如果集合不存在，运行initDatabase云函数
        </div>
    </div>
</body>
</html>