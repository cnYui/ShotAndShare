<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¡¬ç¼–ç é—®é¢˜ä¿®å¤éªŒè¯</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        h1 {
            color: #4a5568;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
        }
        .section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        .section h2 {
            color: #2d3748;
            margin-top: 0;
            font-size: 1.3em;
        }
        .problem {
            background: #fff5f5;
            border-left-color: #e53e3e;
        }
        .solution {
            background: #f0fff4;
            border-left-color: #38a169;
        }
        .verification {
            background: #fffaf0;
            border-left-color: #d69e2e;
        }
        .code {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            margin: 10px 0;
        }
        .highlight {
            background: #fed7d7;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }
        .success {
            background: #c6f6d5;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .before, .after {
            padding: 15px;
            border-radius: 8px;
        }
        .before {
            background: #fff5f5;
            border: 1px solid #fed7d7;
        }
        .after {
            background: #f0fff4;
            border: 1px solid #c6f6d5;
        }
        .before h3, .after h3 {
            margin-top: 0;
            color: #2d3748;
        }
        .note {
            background: #ebf8ff;
            border: 1px solid #bee3f8;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .note::before {
            content: "ğŸ’¡ ";
            font-weight: bold;
        }
        .steps {
            counter-reset: step-counter;
        }
        .step {
            counter-increment: step-counter;
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        .step::before {
            content: counter(step-counter);
            background: #667eea;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ç¡¬ç¼–ç é—®é¢˜ä¿®å¤éªŒè¯</h1>
        
        <div class="section problem">
            <h2>ğŸ› å‘ç°çš„ç¡¬ç¼–ç é—®é¢˜</h2>
            <p>å³ä½¿äº‘å‡½æ•°è¿”å›äº†æ­£ç¡®çš„ <span class="highlight">companionDays</span> å’Œ <span class="highlight">totalExp</span> æ•°æ®ï¼Œå‰ç«¯ä»ç„¶æ˜¾ç¤ºä¸º0ï¼ŒåŸå› æ˜¯å­˜åœ¨ç¡¬ç¼–ç çš„é»˜è®¤å€¼é€»è¾‘ã€‚</p>
            
            <div class="comparison">
                <div class="before">
                    <h3>âŒ é—®é¢˜ä»£ç </h3>
                    <div class="code">
// home.js ä¸­çš„é—®é¢˜
companionDays: petData.companionDays || 0,
totalExp: petData.totalExp || 0

// home.wxml ä¸­çš„é—®é¢˜
{{petInfo.companionDays || 0}}
{{petInfo.totalExp || 0}}
                    </div>
                    <p><strong>é—®é¢˜</strong>ï¼šå½“å€¼ä¸º0æ—¶ï¼Œ|| è¿ç®—ç¬¦ä¼šå°†å…¶è§†ä¸ºfalsyå€¼ï¼Œå¯¼è‡´å§‹ç»ˆä½¿ç”¨é»˜è®¤å€¼0ã€‚</p>
                </div>
                
                <div class="after">
                    <h3>âœ… ä¿®å¤ä»£ç </h3>
                    <div class="code">
// home.js ä¿®å¤å
companionDays: petData.companionDays !== undefined ? 
  petData.companionDays : 0,
totalExp: petData.totalExp !== undefined ? 
  petData.totalExp : 0

// home.wxml ä¿®å¤å
{{petInfo.companionDays}}
{{petInfo.totalExp}}
                    </div>
                    <p><strong>è§£å†³</strong>ï¼šä½¿ç”¨ä¸¥æ ¼çš„undefinedæ£€æŸ¥ï¼Œç¡®ä¿0å€¼èƒ½å¤Ÿæ­£ç¡®æ˜¾ç¤ºã€‚</p>
                </div>
            </div>
        </div>
        
        <div class="section solution">
            <h2>ğŸ› ï¸ ä¿®å¤å†…å®¹</h2>
            
            <h3>1. JavaScripté€»è¾‘ä¿®å¤ (home.js)</h3>
            <div class="code">
// ä¿®å¤å‰ï¼šä½¿ç”¨ || è¿ç®—ç¬¦
companionDays: petData.companionDays || 0,  // å½“å€¼ä¸º0æ—¶ä¼šä½¿ç”¨é»˜è®¤å€¼
totalExp: petData.totalExp || 0             // å½“å€¼ä¸º0æ—¶ä¼šä½¿ç”¨é»˜è®¤å€¼

// ä¿®å¤åï¼šä½¿ç”¨ä¸¥æ ¼çš„undefinedæ£€æŸ¥
companionDays: petData.companionDays !== undefined ? petData.companionDays : 0,
totalExp: petData.totalExp !== undefined ? petData.totalExp : 0
            </div>
            
            <h3>2. æ¨¡æ¿æ˜¾ç¤ºä¿®å¤ (home.wxml)</h3>
            <div class="code">
<!-- ä¿®å¤å‰ï¼šæ¨¡æ¿ä¸­ä¹Ÿæœ‰é»˜è®¤å€¼é€»è¾‘ -->
<text class="stat-value">{{petInfo.companionDays || 0}}</text>
<text class="stat-value">{{petInfo.totalExp || 0}}</text>

<!-- ä¿®å¤åï¼šç›´æ¥æ˜¾ç¤ºæ•°æ® -->
<text class="stat-value">{{petInfo.companionDays}}</text>
<text class="stat-value">{{petInfo.totalExp}}</text>
            </div>
        </div>
        
        <div class="section verification">
            <h2>ğŸ§ª éªŒè¯æ­¥éª¤</h2>
            
            <div class="steps">
                <div class="step">
                    <strong>ç¡®è®¤äº‘å‡½æ•°éƒ¨ç½²</strong><br>
                    ç¡®ä¿petManageräº‘å‡½æ•°å·²æ­£ç¡®éƒ¨ç½²ï¼ŒåŒ…å«created_atå­—æ®µçš„è‡ªåŠ¨ä¿®å¤é€»è¾‘
                </div>
                
                <div class="step">
                    <strong>æ¸…é™¤å°ç¨‹åºç¼“å­˜</strong><br>
                    åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ç‚¹å‡»"æ¸…ç¼“å­˜" â†’ "æ¸…é™¤æ•°æ®ç¼“å­˜"
                </div>
                
                <div class="step">
                    <strong>é‡æ–°è¿›å…¥å® ç‰©é¡µé¢</strong><br>
                    é‡æ–°æ‰“å¼€å°ç¨‹åºï¼Œè¿›å…¥å® ç‰©ä¸»é¡µï¼Œè§¦å‘æ•°æ®åŠ è½½
                </div>
                
                <div class="step">
                    <strong>æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—</strong><br>
                    æŸ¥çœ‹å¼€å‘è€…å·¥å…·æ§åˆ¶å°ï¼Œç¡®è®¤companionDayså’ŒtotalExpçš„å€¼
                </div>
                
                <div class="step">
                    <strong>éªŒè¯æ˜¾ç¤ºæ•ˆæœ</strong><br>
                    ç¡®è®¤é¡µé¢ä¸Šçš„é™ªä¼´å¤©æ•°å’Œæ€»ç»éªŒå€¼ä¸å†å›ºå®šæ˜¾ç¤ºä¸º0
                </div>
            </div>
        </div>
        
        <div class="note">
            <strong>å…³é”®ç†è§£</strong>ï¼šJavaScriptä¸­ï¼Œ0æ˜¯ä¸€ä¸ªfalsyå€¼ï¼Œæ‰€ä»¥ <code>0 || defaultValue</code> ä¼šè¿”å›defaultValueã€‚ä¿®å¤åä½¿ç”¨ <code>!== undefined</code> æ£€æŸ¥ï¼Œç¡®ä¿åªæœ‰åœ¨çœŸæ­£æœªå®šä¹‰æ—¶æ‰ä½¿ç”¨é»˜è®¤å€¼ã€‚
        </div>
        
        <div class="section">
            <h2>ğŸ“Š é¢„æœŸç»“æœ</h2>
            <ul>
                <li><strong>é™ªä¼´å¤©æ•°</strong>ï¼šæ˜¾ç¤ºåŸºäºcreated_atè®¡ç®—çš„å®é™…å¤©æ•°ï¼ˆå¯èƒ½ä¸º0ï¼Œä½†è¿™æ˜¯çœŸå®å€¼ï¼‰</li>
                <li><strong>æ€»ç»éªŒå€¼</strong>ï¼šæ˜¾ç¤ºä»task_recordsç»Ÿè®¡çš„ç´¯è®¡ç»éªŒï¼ˆå¯èƒ½ä¸º0ï¼Œä½†è¿™æ˜¯çœŸå®å€¼ï¼‰</li>
                <li><strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼šå‰ç«¯æ˜¾ç¤ºä¸äº‘å‡½æ•°è¿”å›çš„æ•°æ®å®Œå…¨ä¸€è‡´</li>
                <li><strong>åŠ¨æ€æ›´æ–°</strong>ï¼šå½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé¡µé¢èƒ½å¤Ÿæ­£ç¡®åæ˜ æ–°å€¼</li>
            </ul>
        </div>
    </div>
</body>
</html>